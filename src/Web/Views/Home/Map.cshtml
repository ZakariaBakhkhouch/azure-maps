@{
    Layout = "_Layout";
}

<div>
    <div id="menu">
        <label>Search for a place : </label>
        <br />
        <br />
        <input placeholder="Enter Longitude" id="longitude"/>
        <br />
        <br />
        <input placeholder="Enter Latitude" id="latitude"/>
        <br />
        <br />
        <button type="button" onclick="SearchPlace()">Search</button>
    </div>
    <div id="myMap"></div>
</div>

@section Head {

    <!-- Add references to the Azure Maps Map control JavaScript and CSS files. -->
    <link href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.css" rel="stylesheet" />
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.js"></script>

    <!-- Add a reference to the Azure Maps Services Module JavaScript file. -->
    <script src="https://atlas.microsoft.com/sdk/javascript/service/2/atlas-service.min.js"></script>

    <!-- Add a reference to the SignalR Services Module JavaScript file. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
}

@section Styles {

    <style>
        /* Menu styling */
        #menu {
            position: fixed; /* Fix it to the left side */
            top: 0;
            left: 0;
            width: 300px; /* Set the width */
            height: 100vh; /* Full height of the viewport */
            background-color: #f4f4f4; /* Light gray background */
            padding: 20px; /* Add some padding */
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); /* Add a subtle shadow for depth */
            border-right: 1px solid #ccc; /* Add a border on the right */
            overflow-y: auto; /* Make content scrollable if it overflows */
        }

        /* Map styling */
        #myMap {
            position: fixed; /* Fixed positioning */
            top: 0;
            left: 300px; /* Start to the right of the menu */
            width: calc(100% - 300px); /* Take the remaining width */
            height: 100vh; /* Full height of the viewport */
            background-color: #eaeaea; /* Optional: a background color for visual reference */
        }
    </style>
}

@section Scripts {

    <script>

        function SearchPlace()
        {
            var latitude = document.getElementById('latitude');
            var longitude = document.getElementById('longitude');

            var marker = createMarker(longitude, latitude);

        }

        document.addEventListener('DOMContentLoaded', function () {
            getMap();
        });

        // Function to create a marker for a vehicle
        function createMarker(longitude, latitude) {
            // Define the icon and other properties based on the vehicle
            let imgsrc = 'https://booksappstoragev2.blob.core.windows.net/books/pin-concrete.svg';
            let deligataire = 'Ciment du Maroc';
            let prestation = 'CIMAR GPS';

            // Create the HTML content for the marker
            let htmlContent = `
                    <div class="mover" id="marker-${deviceID}">
                        <img src="${imgsrc}" style="width:30px"/>
                    </div>
                `;

            // Create the marker
            let marker = new atlas.HtmlMarker({
                htmlContent: htmlContent,
                position: [-7.534624, 33.616812], // You need to specify a position
                pixelOffset: [0, -15],
                popup: new atlas.Popup({
                    content: `
                            <div style="padding:10px; background-color: rgba(255, 255, 128, .5);">
                                <ul>
                                    <li><strong>Entreprise:</strong> ${deligataire}</li>
                                    <li><strong>Type:</strong> ${prestation}</li>
                                    <li><strong>IMEI:</strong> </li>
                                    <li><strong>Latitude:</strong> ${latitude}</li>
                                    <li><strong>Longitude:</strong> ${longitude}</li>
                                </ul>
                            </div>
                        `,
                    pixelOffset: [0, -30]
                })
            });

            // Return the created marker
            return marker;
        }

        function getMap() {
            // Initialize a map instance
            var map = new atlas.Map('myMap', {
                center: [-7.534624, 33.616812],
                zoom: 16,
                view: 'Auto',
                style: 'satellite',
                language: 'fr-FR',

                // Add authentication details for connecting to Azure Maps
                authOptions: {
                    authType: 'subscriptionKey',
                    subscriptionKey: '1JnWsaaLCjfbPcxFGIBPy41hUbFh239olcg7CvvMta7gBegVLi94JQQJ99AKAC5RqLJe0trMAAAgAZMP3DE2'
                }
            });

            // Wait until the map resources are ready
            map.events.add('ready', function () {
                // Add map controls
                map.controls.add(
                    [
                        new atlas.control.StyleControl({ mapStyles: ['road', 'grayscale_dark', 'night', 'satellite', 'satellite_road_labels'] }),
                        new atlas.control.FullscreenControl({ style: 'auto' }),
                        new atlas.control.ZoomControl(),
                        new atlas.control.CompassControl(),
                        new atlas.control.PitchControl()
                    ],
                    { position: 'top-right' }
                );

                // Create a marker for the vehicle
                var marker = createMarker('123456789');

                // Add the marker to the map
                map.markers.add(marker);

                // Add a click event listener for toggling the popup
                const markerElement = document.querySelector(`#marker-${123456789}`);
                if (markerElement) {
                    markerElement.addEventListener('click', () => {
                        marker.togglePopup();
                    });
                }
            });
        }
    </script>

}